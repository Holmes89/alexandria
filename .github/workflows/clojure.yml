name: Clojure CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v1
      with:
          path: "ui"
    - name: Install dependencies
      run: lein deps
      working-directory: "./ui"
    - name: Yarn dependencies
      run: yarn install
      working-directory: "./ui"
    - name: Build Prod 
      run: lein prod
      working-directory: "./ui"
    - name: Authenticate into Google Cloud Platform
      uses: actions/gcloud/auth@master
      env:
         GCLOUD_AUTH: ${{ secrets.GCLOUD_AUTH }}
    - name: Sync with GCP
      uses: docker://gcr.io/cloud-builders/gsutil
      with:
        args: "-m rsync -R ./ui/resources/public gs://read.jholmestech.com"
